# LLM客服质量分析系统

一个基于Streamlit的智能客服回答质量评估系统，支持多轮对话生成、质量指标分析、深度质量评估和可视化展示。

## 🚀 快速开始

### 方法1：一键启动（推荐）
```bash
# Windows用户
双击运行 start.bat

# 或者使用Python
python start.py
```

### 方法2：手动启动
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 运行应用
streamlit run app.py
```

### 方法3：详细步骤
如果需要了解详细的配置和操作步骤，请参考[快速入门指南](QUICK_START.md)。

## 📁 项目结构

```
llm_agent_test/
├── app.py                    # 主应用程序
├── ui_components.py          # UI组件模块
├── llm_analyzer.py           # LLM分析器
├── client.py                 # 客户端接口
├── dashboard.py              # 数据仪表板
├── metrics.py                # 质量指标计算
├── start.py                  # 一键启动脚本
├── start.bat                 # Windows批处理启动
├── requirements.txt          # 依赖包清单
├── public/                   # 配置文件目录
│   ├── agents.csv           # 智能体配置
│   ├── analyzer_config.csv  # 分析器配置
│   └── template.csv         # 测试数据模板
├── qa_analysis_results/      # 分析结果存储
├── log/                      # 日志文件
├── README.md                # 项目文档
├── QUICK_START.md           # 快速入门指南
├── CHANGELOG.md             # 更新记录
└── USER_EXPERIENCE_TEST.md  # 用户体验测试
```

## ⚙️ 配置文件详解

### 1. 智能体配置（public/agents.csv）

这是系统的核心配置文件，定义了要测试的智能体信息。

**文件格式：**
```csv
name,description,robot_key,robot_token,url,username
智能体名称,描述信息,机器人密钥,机器人令牌,WebSocket地址,用户名
```

**字段说明：**
- `name`: 智能体显示名称，用于界面展示
- `description`: 智能体的简要描述
- `robot_key`: 机器人的API密钥（需要URL编码）
- `robot_token`: 机器人的访问令牌
- `url`: WebSocket连接地址（可选）
- `username`: 用户名（可选）

**配置步骤：**
1. 打开 `public/agents.csv` 文件
2. 按照格式添加新的智能体信息：
   ```csv
   # 示例配置
   客服机器人A,客服问答机器人,YOUR_ROBOT_KEY,YOUR_ROBOT_TOKEN,wss://your-api.com/ws,your_username
   ```
3. 保存文件
4. 重启应用即可在界面中看到新的智能体选项

**注意事项：**
- 密钥信息需要从您的AI平台获取
- 如果密钥包含特殊字符，需要进行URL编码
- 确保WebSocket地址格式正确

### 2. 分析器配置（public/analyzer_config.csv）

用于配置深度分析功能的API设置。

**文件格式：**
```csv
url,username,robot_key,robot_token
API地址,用户名,机器人密钥,机器人令牌
```

**配置步骤：**
1. 打开 `public/analyzer_config.csv` 文件
2. 更新配置信息：
   ```csv
   https://your-api.com/analyze,your_username,your_key,your_token
   ```
3. 保存文件

### 3. 测试数据模板（public/template.csv）

包含测试问答对的数据文件。

**文件格式：**
```csv
#,问题,回复来源,问题来源,是否满意,序号,问题内容,参考答案
1,用户问题1,FAQ标准答案,FAQ来源,满意,1,具体的问题内容,期望的标准答案
2,用户问题2,FAQ标准答案,FAQ来源,满意,2,具体的问题内容,期望的标准答案
```

**字段说明：**
- `#`: 序号
- `问题`: 问题分类
- `回复来源`: 答案来源类型
- `问题来源`: 问题来源
- `是否满意`: 满意度标记
- `序号`: 问题编号
- `问题内容`: 具体要测试的问题
- `参考答案`: 期望的标准答案

## 📝 如何编写测试文件

### 1. 创建新的测试文件

您可以创建自己的测试数据文件：

```csv
#,问题,回复来源,问题来源,是否满意,序号,问题内容,参考答案
1,账户问题,FAQ标准答案,FAQ来源,满意,1,如何修改登录密码,请在设置-账户安全中修改密码
2,交易问题,FAQ标准答案,FAQ来源,满意,2,如何查看交易记录,请在交易历史页面查看详细记录
3,技术问题,FAQ标准答案,FAQ来源,满意,3,APP闪退怎么办,请尝试重启应用或联系技术支持
```

### 2. 测试数据编写指南

**问题设计原则：**
- 涵盖主要业务场景
- 包含不同难度级别的问题
- 考虑用户常见的表达方式
- 包含边界情况和异常情况

**参考答案要求：**
- 准确性：答案应该正确且完整
- 一致性：同类问题答案风格保持一致
- 实用性：答案应该对用户有实际帮助
- 规范性：遵循公司的回答标准

**示例测试用例：**

```csv
#,问题,回复来源,问题来源,是否满意,序号,问题内容,参考答案
1,基础咨询,FAQ标准答案,FAQ来源,满意,1,你们的客服电话是多少,我们的客服热线是400-123-4567，服务时间为9:00-18:00
2,功能咨询,FAQ标准答案,FAQ来源,满意,2,如何开通VIP会员,请在APP中点击"会员中心"-"开通VIP"，选择合适的套餐完成支付
3,故障报告,FAQ标准答案,FAQ来源,满意,3,无法登录怎么办,请检查网络连接，确认账号密码正确，如仍无法登录请联系客服
4,政策咨询,FAQ标准答案,FAQ来源,满意,4,退款政策是什么,根据我们的退款政策，7天内可申请退款，具体条件请查看用户协议
5,复杂问题,FAQ标准答案,FAQ来源,满意,5,我的订单状态异常,请提供您的订单号，我们会立即为您查询并处理订单问题
```

### 3. 文件上传和使用

1. **准备测试文件**
   - 确保文件格式为UTF-8编码的CSV
   - 按照模板格式填写数据
   - 保存为 `.csv` 文件

2. **在系统中使用**
   - 启动应用后，在"基础分析"标签页
   - 点击"选择文件"按钮上传测试文件
   - 系统会自动验证文件格式和内容
   - 验证通过后即可开始分析

3. **文件验证规则**
   - 必须包含所有必需字段
   - 问题内容不能为空
   - 参考答案不能为空
   - 编码必须为UTF-8

## 🔧 系统功能详解

### 1. 基础分析功能

**操作步骤：**
1. 选择要测试的智能体
2. 上传测试数据文件
3. 设置分析参数（轮次、延迟时间等）
4. 点击"开始分析"按钮
5. 查看分析进度和结果

**分析指标：**
- **语义稳定性**：评估多轮对话的一致性
- **相关性得分**：衡量答案与问题的相关程度
- **完整性得分**：评估答案的完整性
- **冗余性得分**：检测答案的重复和冗余

### 2. 深度分析功能

**操作步骤：**
1. 完成基础分析后
2. 选择要进行深度分析的结果
3. 设置LLM分析参数
4. 点击"开始深度分析"
5. 查看详细的质量报告

**深度分析内容：**
- 答案质量评估
- 语言表达分析
- 内容逻辑检查
- 改进建议

### 3. 数据可视化

**可视化内容：**
- 质量指标分布图
- 时间序列趋势图
- 对比分析图表
- 统计报表

**操作步骤：**
1. 在"数据分析"标签页
2. 选择要可视化的数据
3. 选择图表类型
4. 生成可视化报告

### 4. 结果导出

**支持的导出格式：**
- CSV格式：适用于数据分析
- Excel格式：适用于报告制作
- PDF格式：适用于正式文档
- JSON格式：适用于系统集成

**导出步骤：**
1. 完成分析后
2. 点击"导出结果"按钮
3. 选择导出格式
4. 确认导出设置
5. 下载文件

## 📊 质量指标说明

### 1. 语义稳定性（Semantic Stability）
- **计算方法**：使用ROUGE-L算法计算多轮对话的相似性
- **评分范围**：0-1分，分数越高表示回答越一致
- **应用场景**：评估智能体回答的稳定性

### 2. 相关性得分（Relevance Score）
- **计算方法**：使用TF-IDF和余弦相似度计算
- **评分范围**：0-1分，分数越高表示相关性越强
- **应用场景**：评估答案与问题的匹配程度

### 3. 完整性得分（Completeness Score）
- **计算方法**：基于关键词覆盖率和句子完整性
- **评分范围**：0-1分，分数越高表示回答越完整
- **应用场景**：评估答案是否充分回答了问题

### 4. 冗余性得分（Redundancy Score）
- **计算方法**：检测重复内容和无关信息
- **评分范围**：0-1分，分数越低表示冗余越少
- **应用场景**：评估答案的简洁性

## 🛠️ 高级配置

### 1. 性能优化设置

**批处理大小调整：**
```python
# 在app.py中修改
BATCH_SIZE = 10  # 根据系统性能调整
```

**并发数量设置：**
```python
# 在client.py中修改
MAX_CONCURRENT = 5  # 根据API限制调整
```

### 2. 自定义指标

您可以在 `metrics.py` 中添加自定义的质量指标：

```python
def custom_metric(question, answer, reference):
    """
    自定义质量指标
    """
    # 您的计算逻辑
    return score
```

### 3. 主题样式定制

修改 `app.py` 中的样式设置：

```python
# 自定义CSS样式
st.markdown("""
<style>
/* 您的自定义样式 */
</style>
""", unsafe_allow_html=True)
```

## 🚨 常见问题解答

### Q1: 如何添加新的智能体？
A1: 在 `public/agents.csv` 文件中添加新行，包含智能体的配置信息。

### Q2: 测试数据格式要求是什么？
A2: 必须是UTF-8编码的CSV文件，包含必需的字段：问题内容、参考答案等。

### Q3: 如何提高分析速度？
A3: 可以调整批处理大小、减少测试轮次、优化网络连接。

### Q4: 分析结果如何解读？
A4: 各项指标分数越高表示质量越好，但需要结合具体业务场景理解。

### Q5: 如何导出分析报告？
A5: 在结果页面点击"导出结果"，选择合适的格式进行下载。

## 📈 系统监控

### 1. 日志查看

所有操作日志保存在 `log/` 目录中：
- 按日期命名：`qa_analysis_YYYYMMDD_HHMMSS.log`
- 包含详细的分析过程和错误信息
- 用于故障排查和性能分析

### 2. 性能监控

**关键指标：**
- API响应时间
- 分析完成率
- 错误率统计
- 资源使用情况

### 3. 数据备份

**自动备份：**
- 分析结果自动保存到 `qa_analysis_results/` 目录
- 临时文件定期清理
- 日志文件定期归档

## 🔒 安全考虑

### 1. API密钥管理
- 不要在代码中硬编码密钥
- 定期更换API密钥
- 使用环境变量存储敏感信息

### 2. 数据隐私
- 测试数据应当脱敏处理
- 分析结果注意保密
- 遵循数据保护法规

### 3. 访问控制
- 限制系统访问权限
- 定期审核用户权限
- 监控异常访问行为

## 📞 技术支持

### 获取帮助
- 查看[快速入门指南](QUICK_START.md)
- 阅读[用户体验测试](USER_EXPERIENCE_TEST.md)
- 查看[更新日志](CHANGELOG.md)

### 问题反馈
- 提交Issue到项目仓库
- 发送邮件至技术支持
- 联系项目维护者

### 版本更新
- 定期检查更新
- 备份重要数据
- 测试新功能

## 📄 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

## 🎯 未来规划

- [ ] 支持更多AI平台接入
- [ ] 增加实时监控功能
- [ ] 优化分析算法
- [ ] 增强可视化效果
- [ ] 支持多语言分析

---

**开始使用系统前，请确保：**
1. ✅ 已正确配置智能体信息
2. ✅ 已准备好测试数据文件
3. ✅ 已了解各项质量指标含义
4. ✅ 已配置好分析参数

**如有任何疑问，请参考快速入门指南或联系技术支持。** 